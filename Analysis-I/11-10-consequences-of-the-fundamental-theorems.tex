\section{Consequences of the fundamental theorems}\label{sec 11.10}

\begin{proposition}[Integration by parts formula]\label{11.10.1}
    Let \(I = [a, b]\), and let \(F : [a, b] \to \mathbf{R}\) and \(G : [a, b] \to \mathbf{R}\) be differentiable functions on \([a, b]\) such that \(F'\) and \(G'\) are Riemann integrable on \(I\).
    Then we have
    \[
        \int_{[a, b]} F G' = F(b) G(b) - F(a) G(a) - \int_{[a, b]} F' G.
    \]
\end{proposition}

\begin{proof}
    Since \(F\) is an antiderivative of \(F'\) and \(F'\) is Riemann integrable on \([a, b]\), by Theorem \ref{11.9.1} we know that \(F\) is continuous on \([a, b]\).
    Similarly \(G\) is continuous on \([a, b]\).
    By Corollary \ref{11.5.2} we know that \(F\) and \(G\) are Riemann integrable on \([a, b]\).
    By Theorem \ref{11.4.5} we know that \(F G'\) and \(F' G\) are Riemann integrable on \([a, b]\).
    By Theorem \ref{10.1.13}(d) we have \((FG)' = F' G + F G'\).
    Thus by Theorem \ref{11.4.1}(a) \((FG)'\) is Riemann integrable on \([a, b]\) and
    \begin{align*}
        \int_{[a, b]} (F G') & = \int_{[a, b]} \big((FG)' - F' G\big)                                                       \\
                             & = \int_{[a, b]} \big((FG)'\big) - \int_{[a, b]} (F' G) & \text{(by Theorem \ref{11.4.1}(c))} \\
                             & = F(b) G(b) - F(a) G(a) - \int_{[a, b]} (F' G).        & \text{(by Theorem \ref{11.9.4})}
    \end{align*}
\end{proof}

\begin{theorem}\label{11.10.2}
    Let \(\alpha : [a, b] \to \mathbf{R}\) be a monotone increasing function, and suppose that \(\alpha\) is also differentiable on \([a, b]\), with \(\alpha'\) being Riemann integrable.
    Let \(f : [a, b] \to \mathbf{R}\) be a piecewise constant function on \([a, b]\).
    Then \(f \alpha'\) is Riemann integrable on \([a, b]\), and
    \[
        \int_{[a, b]} f \; d \alpha = \int_{[a, b]} f \alpha'.
    \]
\end{theorem}

\begin{proof}
    Since \(f\) is piecewise constant, it is Riemann integrable, and since \(\alpha'\) is also Riemann integrable, then \(f \alpha'\) is Riemann integrable by Theorem \ref{11.4.5}.

    Suppose that \(f\) is piecewise constant with respect to some partition \(\mathbf{P}\) of \([a, b]\);
    without loss of generality we may assume that \(\mathbf{P}\) does not contain the empty set.
    Then we have
    \[
        \int_{[a, b]} f \; d \alpha = p.c. \int_{[\mathbf{P}]} f \; d \alpha = \sum_{J \in \mathbf{P}} c_J \alpha[J]
    \]
    where \(c_J\) is the constant value of \(f\) on \(J\).
    On the other hand, from Theorem \ref{11.4.1}(h) (and Exercise \ref{ex 11.4.3}) we have
    \[
        \int_{[a, b]} f \alpha' = \sum_{J \in \mathbf{P}} \int_J f \alpha' = \sum_{J \in \mathbf{P}} \int_J c_J \alpha' = \sum_{J \in \mathbf{P}} c_J \int_J \alpha'.
    \]
    But by the second fundamental theorem of calculus (Theorem \ref{11.9.4}), \(\int_J \alpha' = \alpha[J]\), and the claim follows.
\end{proof}

\begin{corollary}\label{11.10.3}
    Let \(\alpha : [a, b] \to \mathbf{R}\) be a monotone increasing function, and suppose that \(\alpha\) is also differentiable on \([a, b]\), with \(\alpha'\) being Riemann integrable.
    Let \(f : [a, b] \to \mathbf{R}\) be a function which is Riemann-Stieltjes integrable with respect to \(\alpha\) on \([a, b]\).
    Then \(f \alpha'\) is Riemann integrable on \([a, b]\), and
    \[
        \int_{[a, b]} f \; d \alpha = \int_{[a, b]} f \alpha'.
    \]
\end{corollary}

\begin{proof}
    Note that since \(f\) and \(\alpha'\) are bounded, then \(f \alpha'\) must also be bounded.
    Also, since \(\alpha\) is monotone increasing and differentable, \(\alpha'\) is non-negative (by Proposition \ref{10.3.1}).

    Let \(\varepsilon > 0\).
    Then, we can find a piecewise constant function \(\overline{f}\) majorizing \(f\) on \([a, b]\), and a piecewise constant function \(\underline{f}\) minorizing \(f\) on \([a, b]\), such that
    \[
        \int_{[a, b]} f \; d \alpha - \varepsilon \leq \int_{[a, b]} \underline{f} \; d \alpha \leq \int_{[a, b]} \overline{f} \; d \alpha \leq \int_{[a, b]} f \; d \alpha + \varepsilon.
    \]
    Applying Theorem \ref{11.10.2}, we obtain
    \[
        \int_{[a, b]} f \; d \alpha - \varepsilon \leq \int_{[a, b]} \underline{f} \alpha' \leq \int_{[a, b]} \overline{f} \alpha' \leq \int_{[a, b]} f \; d \alpha + \varepsilon.
    \]

    Since \(\alpha'\) is non-negative and \(\underline{f}\) minorizes \(f\), then \(\underline{f} \alpha'\) minorizes \(f \alpha'\).
    Thus \(\int_{[a, b]} \underline{f} \alpha' \leq \underline{\int}_{[a, b]} f \alpha'\).
    Thus
    \[
        \int_{[a, b]} f \; d \alpha - \varepsilon \leq \underline{\int}_{[a, b]} f \alpha'.
    \]
    Similarly we have
    \[
        \overline{\int}_{[a, b]} f \alpha' \leq \int_{[a, b]} f \; d \alpha + \varepsilon.
    \]
    Since these statements are true for any \(\varepsilon > 0\), we must have
    \[
        \int_{[a, b]} f \; d \alpha \leq \underline{\int}_{[a, b]} f \alpha' \leq \overline{\int}_{[a, b]} f \alpha' \leq \int_{[a, b]} f \; d \alpha
    \]
    and the claim follows.
\end{proof}

\begin{remark}\label{11.10.4}
    Informally, Corollary \ref{11.10.3} asserts that \(f \; d \alpha\) is essentially equivalent to \(f \frac{d \alpha}{dx} dx\), when \(\alpha\) is differentiable.
    However, the advantage of the Riemann-Stieltjes integral is that it still makes sense even when \(\alpha\) is not differentiable.
\end{remark}

\begin{lemma}[Change of variables formula I]\label{11.10.5}
    Let \([a, b]\) be a closed interval, and let \(\phi : [a, b] \to [\phi(a), \phi(b)]\) be a continuous monotone increasing function.
    Let \(f : [\phi(a), \phi(b)] \to \mathbf{R}\) be a piecewise constant function on \([\phi(a), \phi(b)]\).
    Then \(f \circ \phi : [a, b] \to \mathbf{R}\) is also piecewise constant on \([a, b]\), and
    \[
        \int_{[a, b]} f \circ \phi \; d \phi = \int_{[\phi(a), \phi(b)]} f.
    \]
\end{lemma}

\begin{proof}
    Let \(\mathbf{P}\) be a partition of \([\phi(a), \phi(b)]\) such that \(f\) is piecewise constant with respect to \(\mathbf{P}\);
    we may assume that \(\mathbf{P}\) does not contain the empty set.
    For each \(J \in \mathbf{P}\), let \(c_J\) be the constant value of \(f\) on \(J\), thus
    \[
        \int_{[\phi(a), \phi(b)]} f = \sum_{J \in \mathbf{P}} c_J \abs*{J}.
    \]
    For each interval \(J\), let \(\phi^{-1}(J)\) be the set \(\phi^{-1}(J) \coloneqq \{x \in [a, b] : \phi(x) \in J\}\).
    Then \(\phi^{-1}(J)\) is connected (by Proposition \ref{9.8.3} and Lemma \ref{11.1.4}), and is thus an interval.
    Furthermore, \(c_J\) is the constant value of \(f \circ \phi\) on \(\phi^{-1}(J)\) (since \((f \circ \phi)\big(\phi^{-1}(J)\big) = f(J)\)).
    Thus, if we define \(\mathbf{S} \coloneqq \{\phi^{-1} (J) : J \in \mathbf{P}\}\), then \(\mathbf{S}\) partitions \([a, b]\)
    (\(\mathbf{S}\) is finite since \(\mathbf{P}\) is finite;
    \(\phi^{-1}(J)\) is an interval and \(\phi\) is a bijection from \([a, b]\) to \([\phi(a), \phi(b)]\)),
    and \(f \circ \phi\) is piecewise constant with respect to \(\mathbf{S}\) (for every \(\phi^{-1}(J) \in \mathbf{S}\), \(f\) is constant on \(\phi^{-1}(J)\)).
    Thus
    \[
        \int_{[a, b]} f \circ \phi \; d \phi = p.c. \int_{[\mathbf{S}]} f \circ \phi \; d \phi = \sum_{J \in \mathbf{P}} c_J \phi[\phi^{-1}(J)].
    \]
    But \(\phi[\phi^{-1}(J)] = \abs*{J}\) (since \(\phi(\phi^{-1}(J)) = J\) and \(\phi\) is continuous), and the claim follows.
\end{proof}

\begin{proposition}[Change of variables formula II]\label{11.10.6}
    Let \([a, b]\) be a closed interval, and let \(\phi : [a, b] \to [\phi(a), \phi(b)]\) be a continuous monotone increasing function.
    Let \(f : [\phi(a), \phi(b)] \to \mathbf{R}\) be a Riemann integrable function on \([\phi(a), \phi(b)]\).
    Then \(f \circ \phi : [a, b] \to \mathbf{R}\) is Riemann-Stieltjes integrable with respect to \(\phi\) on \([a, b]\), and
    \[
        \int_{[a, b]} f \circ \phi \; d \phi = \int_{[\phi(a), \phi(b)]} f.
    \]
\end{proposition}

\begin{proof}
    This will be obtained from Lemma \ref{11.10.5} in a similar manner to how Corollary \ref{11.10.3} was obtained from Theorem \ref{11.10.2}.
    First observe that since \(f\) is Riemann integrable, it is bounded, and then \(f \circ \phi\) must also be bounded (by Proposition \ref{9.8.3} \(\phi\) is a bijection).

    Let \(\varepsilon > 0\).
    Then, we can find a piecewise constant function \(\overline{f}\) majorizing \(f\) on \([\phi(a), \phi(b)]\), and a piecewise constant function \(\underline{f}\) minorizing \(f\) on \([\phi(a), \phi(b)]\), such that
    \[
        \int_{[\phi(a), \phi(b)]} f - \varepsilon \leq \int_{[\phi(a), \phi(b)]} \underline{f} \leq \int_{[\phi(a), \phi(b)]} \overline{f} \leq \int_{[\phi(a), \phi(b)]} f + \varepsilon.
    \]
    Applying Lemma \ref{11.10.5}, we obtain
    \[
        \int_{[\phi(a), \phi(b)]} f - \varepsilon \leq \int_{[a, b]} \underline{f} \circ \phi \; d \phi \leq \int_{[a, b]} \overline{f} \circ \; d \phi \leq \int_{[\phi(a), \phi(b)]} f + \varepsilon.
    \]
    Since \(\underline{f} \circ \phi\) is piecewise constant and minorizes \(f \circ \phi\), we have
    \[
        \int_{[a, b]} \underline{f} \circ \phi \; d \phi \leq \underline{\int}_{[a, b]} f \circ \phi \; d \phi
    \]
    while similarly we have
    \[
        \int_{[a, b]} \overline{f} \circ \phi \; d \phi \geq \overline{\int}_{[a, b]} f \circ \phi \; d \phi.
    \]
    Thus
    \[
        \int_{[\phi(a), \phi(b)]} f - \varepsilon \leq \underline{\int}_{[a, b]} f \circ \phi \; d \phi \leq \overline{\int}_{[a, b]} f \circ \; d \phi \leq \int_{[\phi(a), \phi(b)]} f + \varepsilon.
    \]
    Since \(\varepsilon > 0\) was arbitrary, this implies that
    \[
        \int_{[\phi(a), \phi(b)]} f \leq \underline{\int}_{[a, b]} f \circ \phi \; d \phi \leq \overline{\int}_{[a, b]} f \circ \; d \phi \leq \int_{[\phi(a), \phi(b)]} f
    \]
    and the claim follows.
\end{proof}

\begin{proposition}[Change of variables formula III]\label{11.10.7}
    Let \([a, b]\) be a closed interval, and let \(\phi : [a, b] \to [\phi(a), \phi(b)]\) be a differentiable monotone increasing function such that \(\phi'\) is Riemann integrable.
    Let \(f : [\phi(a), \phi(b)] \to \mathbf{R}\) be a Riemann integrable function on \([\phi(a), \phi(b)]\).
    Then \((f \circ \phi) \phi' : [a, b] \to \mathbf{R}\) is Riemann integrable on \([a, b]\), and
    \[
        \int_{[a, b]} (f \circ \phi) \phi' = \int_{[\phi(a), \phi(b)]} f.
    \]
\end{proposition}

\begin{proof}
    Since \(\phi\) is differentable on \([a, b]\), by Corollary \ref{10.1.12} we know that \(\phi\) is continuous on \([a, b]\).
    By Proposition \ref{11.10.6} we know that \(f \circ \phi\) is Riemann-Stieltjes integrable with respect to \(\phi\) on \([a, b]\).
    By Corollary \ref{11.10.3} we know that \((f \circ \phi) \phi'\) is Riemann integrable on \([a, b]\), and
    \begin{align*}
        \int_{[a, b]} (f \circ \phi) \phi' & = \int_{[a, b]} (f \circ \phi) \; d \phi & \text{(by Corollary \ref{11.10.3})}   \\
                                           & = \int_{[\phi(a), \phi(b)]} f.           & \text{(by Proposition \ref{11.10.6})}
    \end{align*}
\end{proof}

\begin{additional corollary}[Change of variables formula IV]\label{ac 11.10.1}
Let \([a, b]\) be a closed interval, and let \(\phi : [a, b] \to [\phi(a), \phi(b)]\) be a differentiable function such that \(\phi'\) is Riemann integrable.
Let \(f : [\phi(a), \phi(b)] \to \mathbf{R}\) be a continuous function on \([\phi(a), \phi(b)]\).
Then \((f \circ \phi) \phi' : [a, b] \to \mathbf{R}\) is Riemann integrable on \([a, b]\), and
\[
    \int_{[a, b]} (f \circ \phi) \phi' = \int_{[\phi(a), \phi(b)]} f.
\]
\end{additional corollary}

\begin{proof}
    Since \(\phi\) is differentiable on \([a, b]\), by Corollary \ref{10.1.12} we know that \(\phi\) is continuous on \([a, b]\).
    Since \(f\) is continuous on \([\phi(a), \phi(b)]\) and \(\phi\) is continuous on \([a, b]\), by Proposition \ref{9.4.13} we know that \(f \circ \phi\) is continuous on \([a, b]\).
    By Corollary \ref{11.5.2} we know that \(f \circ \phi\) is Riemann integrable on \([a, b]\).
    Since \(\phi'\) is Riemann integrable on \([a, b]\), by Theorem \ref{11.4.5} we know that \((f \circ \phi) \phi'\) is Riemann integrable on \([a, b]\).
    Thus
    \[
        \int_{[a, b]} (f \circ \phi) \phi'
    \]
    is well-defined.
    Since \(f\) is continuous on \([\phi(a), \phi(b)]\), by Corollary \ref{11.5.2} we know that \(f\) is Riemann integrable on \([\phi(a), \phi(b)]\).
    Thus
    \[
        \int_{[\phi(a), \phi(b)]} f
    \]
    is well-defined.
    Let \(F : [\phi(a), \phi(b)] \to \mathbf{R}\) be the function
    \[
        F(x) = \int_{[\phi(a), x]} f
    \]
    Since \(f\) is continuous on \([\phi(a), \phi(b)]\), by Theorem \ref{11.9.1} we know that \(F'(x) = f(x)\) for each \(x \in [\phi(a), \phi(b)]\).
    Then by Proposition \ref{10.1.15} we have
    \[
        \forall\ x \in [a, b], (F \circ \phi)'(x) = F'\big(\phi(x)\big) \phi'(x) = f\big(\phi(x)\big) \phi'(x) = (f \circ \phi)(x) \cdot \phi(x)
    \]
    and \((F \circ \phi)' = (f \circ \phi) \phi'\).
    Thus
    \begin{align*}
        \int_{[a, b]} (f \circ \phi) \phi' & = \int_{[a, b]} (F \circ \phi)'                                                                \\
                                           & = (F \circ \phi)(b) - (F \circ \phi)(a)                     & \text{(by Theorem \ref{11.9.4})} \\
                                           & = F\big(\phi(b)\big) - F\big(\phi(a)\big)                                                      \\
                                           & = \int_{[\phi(a), \phi(b)]} f - \int_{[\phi(a), \phi(a)]} f                                    \\
                                           & = \int_{[\phi(a), \phi(b)]} f.
    \end{align*}
\end{proof}

\exercisesection

\begin{exercise}\label{ex 11.10.1}
    Prove Proposition \ref{11.10.1}.
\end{exercise}

\begin{proof}
    See Proposition \ref{11.10.1}.
\end{proof}

\begin{exercise}\label{ex 11.10.2}
    Fill in the gaps marked (why?) in the proof of Lemma \ref{11.10.5}.
\end{exercise}

\begin{proof}
    See Lemma \ref{11.10.5}.
\end{proof}

\begin{exercise}\label{ex 11.10.3}
    Let \(a < b\) be real numbers, and let \(f : [a, b] \to \mathbf{R}\) be a Riemann integrable function.
    Let \(g : [-b, -a] \to \mathbf{R}\) be defined by \(g(x) \coloneqq f(-x)\).
    Show that \(g\) is also Riemann integrable, and \(\int_{[-b, -a]} g = \int_{[a, b]} f\).
\end{exercise}

\begin{proof}
    Let \(\varepsilon > 0\).
    Then, we can find a piecewise constant function \(\overline{f}\) majorizing \(f\) on \([a, b]\), and a piecewise constant function \(\underline{f}\) minorizing \(f\) on \([a, b]\), such that
    \[
        \int_{[a, b]} f - \varepsilon \leq \int_{[a, b]} \underline{f} = \int_{[a, b]} \overline{f} \leq \int_{[a, b]} f + \varepsilon.
    \]
    Let \(\overline{g} : [-b, -a] \to \mathbf{R}\) be the function \(\overline{g}(x) = \overline{f}(-x)\).
    Since \(\overline{f}\) majorizes \(f\) on \([a, b]\), we know that \(\overline{g}\) majorizes \(g\) on \([-b, -a]\) and
    \[
        \int_{[-b, -a]} \overline{g} = \int_{[a, b]} \overline{f} \leq \int_{[a, b]} f + \varepsilon.
    \]
    Let \(\underline{g} : [-b, -a] \to \mathbf{R}\) be the function \(\underline{g}(x) = \underline{f}(-x)\).
    Since \(\underline{f}\) minorizes \(f\) on \([a, b]\), we know that \(\underline{g}\) minorizes \(g\) on \([-b, -a]\) and
    \[
        \int_{[-b, -a]} \underline{g} = \int_{[a, b]} \underline{f} \geq \int_{[a, b]} f - \varepsilon.
    \]
    By Definition \ref{11.3.2} and Proposition \ref{11.3.3} we have
    \[
        \int_{[a, b]} f - \varepsilon \leq \int_{[-b, -a]} \underline{g} \leq \underline{\int}_{[-b, -a]} g \leq \overline{\int}_{[-b, -a]} g \leq \int_{[-b, -a]} \overline{g} \leq \int_{[a, b]} f + \varepsilon.
    \]
    Since these statements are true for any \(\varepsilon > 0\), we must have
    \[
        \int_{[a, b]} f \leq \underline{\int}_{[-b, -a]} g \leq \overline{\int}_{[-b, -a]} g \leq \int_{[a, b]} f
    \]
    and the claim follows.
\end{proof}

\begin{exercise}\label{ex 11.10.4}
    What is the analogue of Proposition \ref{11.10.7} when \(\phi\) is monotone decreasing instead of monotone increasing?
    (When \(\phi\) is neither monotone increasing or monotone decreasing, the situation becomes significantly more complicated.)
\end{exercise}

\begin{proof}
    Let \([a, b]\) be a closed interval, and let \(\phi : [a, b] \to \big[\phi(b), \phi(a)\big]\) be a differentiable monotone decreasing function such that \(\phi'\) is Riemann integrable.
    Let \(f : \big[\phi(b), \phi(a)\big] \to \mathbf{R}\) be a Riemann integrable function on \(\big[\phi(b), \phi(a)\big]\).
    Then \((f \circ \phi) \phi' : [a, b] \to \mathbf{R}\) is Riemann integrable on \([a, b]\), and
    \[
        \int_{[a, b]} (f \circ \phi) \phi' = -\int_{[\phi(b), \phi(a)]} f.
    \]

    Now we proof the statement.
    Let \(\eta : [-b, -a] \to [a, b]\) be the function \(\eta = x \mapsto -x\).
    Let \(\gamma : [-b, -a] \to [\phi(b), \phi(a)]\) be the function
    \[
        \forall\ x \in [-b, -a], \gamma(x) = \phi(-x) = (\phi \circ \eta)(x).
    \]
    Since \(\eta\) is differentiable on \([-b, -a]\), by chain rule (Theorem \ref{10.1.15}) we know that
    \[
        \forall\ x \in [-b, -a], \gamma'(x) = (\phi \circ \eta)'(x) = \phi'\big(\eta(x)\big) \eta'(x) = \phi'\big(\eta(x)\big) (-1) = - (\phi' \circ \eta)(x).
    \]
    Observe that
    \begin{align*}
                 & \forall\ x, y \in [-b, -a], x \leq y                                            \\
        \implies & -x \geq -y                                                                      \\
        \implies & \phi(-x) \leq \phi(-y)               & \text{(\(\phi\) is monotone decreasing)} \\
        \implies & \gamma(x) \leq \gamma(y).
    \end{align*}
    Thus \(\gamma\) is monotone increasing and by Proposition \ref{11.10.7} we have
    \[
        \int_{[-b, -a]} (f \circ \gamma) \gamma' = \int_{[\gamma(-b), \gamma(-a)]} f.
    \]
    Since
    \begin{align*}
         & \int_{[-b, -a]} (f \circ \gamma) \gamma'                                                                              \\
         & = \int_{[-b, -a]} (f \circ \phi \circ \eta) \cdot (\phi \circ \eta)'                                                  \\
         & = \int_{[-b, -a]} (f \circ \phi \circ \eta) \cdot \big(-(\phi' \circ \eta)\big) & \text{(from the proof above)}       \\
         & = -\int_{[-b, -a]} (f \circ \phi \circ \eta) \cdot (\phi' \circ \eta)           & \text{(by Theorem \ref{11.4.1}(b))}
    \end{align*}
    and
    \[
        \int_{[\gamma(-b), \gamma(-a)]} f = \int_{\big[\phi(b), \phi(a)\big]} f,
    \]
    we know that
    \[
        \int_{[-b, -a]} (f \circ \phi \circ \eta) \cdot (\phi' \circ \eta) = -\int_{\big[\phi(b), \phi(a)\big]} f.
    \]
    Since
    \begin{align*}
        \forall\ x \in [a, b], & \big((f \circ \phi) \cdot \phi'\big)(x)                                                                   \\
                               & = (f \circ \phi)(x) \cdot \phi'(x)                                  & \text{(by Definition \ref{9.2.1})}  \\
                               & = (f \circ \phi \circ \eta)(-x) \cdot (\phi' \circ \eta)(-x)        & \text{(by Definition \ref{3.3.10})} \\
                               & = \big((f \circ \phi \circ \eta) \cdot (\phi' \circ \eta)\big)(-x), & \text{(by Definition \ref{9.2.1})}
    \end{align*}
    By Exercise \ref{ex 11.10.3} we know that
    \[
        \int_{[a, b]} (f \circ \phi) \phi' = \int_{[-b, -a]} (f \circ \phi \circ \eta) \cdot (\phi' \circ \eta).
    \]
\end{proof}