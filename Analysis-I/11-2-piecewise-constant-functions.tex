\section{Piecewise constant functions}\label{sec:11.2}

\begin{defn}[Constant functions]\label{11.2.1}
  Let \(X\) be a subset of \(\R\), and let \(f : X \to \R\) be a function.
  We say that \(f\) is \emph{constant} iff there exists a real number \(c\) such that \(f(x) = c\) for all \(x \in X\).
  If \(E\) is a subset of \(X\), we say that \(f\) is \emph{constant on} \(E\) if the restriction \(f|_E\) of \(f\) to \(E\) is constant, in other words there exists a real number \(c\) such that \(f(x) = c\) for all \(x \in E\).
  We refer to \(c\) as the \emph{constant value} of \(f\) on \(E\).
\end{defn}

\begin{rmk}\label{11.2.2}
  If \(E\) is a non-empty set, then a function \(f\) which is constant on \(E\) can have only one constant value;
  However, if \(E\) is empty, every real number \(c\) is a constant value for \(f\) on \(E\).
\end{rmk}

\begin{defn}[Piecewise constant functions I]\label{11.2.3}
  Let \(I\) be a bounded interval, let \(f : I \to \R\) be a function, and let \(\mathbf{P}\) be a partition of \(I\).
  We say that \(f\) is \emph{piecewise constant with respect to \(\mathbf{P}\)} if for every \(J \in \mathbf{P}\), \(f\) is constant on \(J\).
\end{defn}

\setcounter{thm}{4}
\begin{defn}[Piecewise constant functions II]\label{11.2.5}
  Let \(I\) be a bounded interval, and let \(f : I \to \R\) be a function.
  We say that \(f\) is \emph{piecewise constant on \(I\)} if there exists a partition \(\mathbf{P}\) of \(I\) such that \(f\) is piecewise constant with respect to \(\mathbf{P}\).
\end{defn}

\setcounter{thm}{6}
\begin{lem}\label{11.2.7}
  Let \(I\) be a bounded interval, let \(\mathbf{P}\) be a partition of \(I\), and let \(f : I \to \R\) be a function which is piecewise constant with respect to \(\mathbf{P}\).
  Let \(\mathbf{P}'\) be a partition of \(I\) which is finer than \(\mathbf{P}\).
  Then \(f\) is also piecewise constant with respect to \(\mathbf{P}'\).
\end{lem}

\begin{proof}
  Let \(K' \in \mathbf{P}'\).
  Since \(\mathbf{P}'\) is finer than \(\mathbf{P}\), by \cref{11.1.14} \(\exists K \in \mathbf{P}\) such that \(K' \subseteq K\).
  Since \(f\) is piecewise constant with respect to \(\mathbf{P}\), by \cref{11.2.3} we know that \(\forall x \in K\), \(f(x)\) is constant.
  Thus for every \(x \in K'\), \(x \in K\) and \(f(x)\) is constant.
  Since \(K'\) is arbitrary, by \cref{11.2.3} \(f\) is piecewise constant with respect to \(\mathbf{P}'\).
\end{proof}

\begin{lem}\label{11.2.8}
  Let \(I\) be a bounded interval, and let \(f : I \to \R\) and \(g : I \to \R\) be piecewise constant functions on \(I\).
  Then the functions \(f + g\), \(f - g\), \(\max(f, g)\), \(\min(f, g)\) and \(fg\) are also piecewise constant functions on \(I\).
  Here of course \(\max(f, g) : I \to \R\) is the function \(\max(f, g)(x) \coloneqq \max(f(x), g(x))\).
  If \(g\) does not vanish anywhere on \(I\) (i.e., \(g(x) \neq 0\) for all \(x \in I\)) then \(f / g\) is also a piecewise constant function on \(I\).
\end{lem}

\begin{proof}
  Since \(f\) is piecewise constant function on \(I\), by \cref{11.2.5} \(\exists \mathbf{P}\) such that \(\mathbf{P}\) is a partition of \(I\) and \(f\) is piecewise constant with respect to \(\mathbf{P}\).
  Similarly \(\exists \mathbf{P}'\) such that \(\mathbf{P}'\) is a partition of \(I\) and \(g\) is piecewise constant with respect to \(\mathbf{P}'\).
  By \cref{11.1.18} we know that \(\mathbf{P} \# \mathbf{P}'\) is also a partition of \(I\) and \(\mathbf{P} \# \mathbf{P}'\) is both finer than \(\mathbf{P}\) and finer than \(\mathbf{P}'\).
  By \cref{11.2.7} we know that both \(f\) and \(g\) are piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\).

  Now we show that \(f, g\) remain piecewise constant functions on \(I\) after algebraic operation.
  For every \(J \in \mathbf{P} \# \mathbf{P}'\), we have \(f(x)\) is constant and \(g(x)\) is constant for every \(x \in J\).
  Thus we know that \(f(x) + g(x)\), \(f(x) - g(x)\), \(\max\big(f(x), g(x)\big)\), \(\min\big(f(x), g(x)\big)\) and \(f(x) g(x)\) are constant.
  If \(g(x) \neq 0\), then we also have \(f(x) / g(x)\) is constant.
  Thus by \cref{11.2.3} \(f + g\), \(f - g\), \(\max(f, g)\), \(\min(f, g)\), \(fg\) is piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\), and when \(g(x) \neq 0\) we have \(f / g\) is piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\).
  By \cref{11.2.5} \(f + g\), \(f - g\), \(\max(f, g)\), \(\min(f, g)\), \(fg\) is piecewise constant on \(I\), and when \(g(x) \neq 0\) we have \(f / g\) is piecewise constant on \(I\).
\end{proof}

\begin{defn}[Piecewise constant integral I]\label{11.2.9}
  Let \(I\) be a bounded interval, let \(\mathbf{P}\) be a partition of \(I\).
  Let \(f : I \to \R\) be a function which is piecewise constant with respect to \(\mathbf{P}\).
  Then we define the \emph{piecewise constant integral} \(p.c. \int_{[\mathbf{P}]} f\) of \(f\) with respect to the partition \(\mathbf{P}\) by the formula
  \[
    p.c. \int_{[\mathbf{P}]} f \coloneqq \sum_{J \in \mathbf{P}} c_J \abs{J},
  \]
  where for each \(J\) in \(\mathbf{P}\), we let \(c_J\) be the constant value of \(f\) on \(J\).
\end{defn}

\begin{rmk}\label{11.2.10}
  This definition seems like it could be ill-defined, because if \(J\) is empty then every number \(c_J\) can be the constant value of \(f\) on \(J\), but fortunately in such cases \(\abs{J}\) is zero and so the choice of \(c_J\) is irrelevant.
  The notation \(p.c. \int_{[\mathbf{P}]} f\) is rather artificial, but we shall only need it temporarily, en route to a more useful definition.
  Note that since \(\mathbf{P}\) is finite, the sum \(\sum_{J \in \mathbf{P}} c_J \abs{J}\) is always well-defined
  (it is never divergent or infinite).
\end{rmk}

\begin{rmk}\label{11.2.11}
  The piecewise constant integral corresponds intuitively to one's notion of area, given that the area of a rectangle ought to be the product of the lengths of the sides.
  (Of course, if \(f\) is negative somewhere, then the ``area'' \(c_J \abs{J}\) would also be negative.)
\end{rmk}

\setcounter{thm}{12}
\begin{prop}[Piecewise constant integral is independent of partition]\label{11.2.13}
  Let \(I\) be a bounded interval, and let \(f : I \to \R\) be a function.
  Suppose that \(\mathbf{P}\) and \(\mathbf{P}'\) are partitions of \(I\) such that \(f\) is piecewise constant both with respect to \(\mathbf{P}\) and with respect to \(\mathbf{P}'\).
  Then \(p.c. \int_{[\mathbf{P}]} f = p.c. \int_{[\mathbf{P}']} f\).
\end{prop}

\begin{proof}
  By \cref{11.1.18} we know that \(\mathbf{P} \# \mathbf{P}'\) is a partition of \(I\) and is both finer than \(\mathbf{P}\) and finer than \(\mathbf{P}'\), thus by \cref{11.2.9} we have
  \[
    p.c. \int_{[\mathbf{P} \# \mathbf{P}']} f = \sum_{J \in \mathbf{P} \# \mathbf{P}'} c_J \abs{J}.
  \]
  By \cref{11.1.13}, we know that
  \[
    \abs{I} = \sum_{J \in \mathbf{P}} \abs{J} = \sum_{J \in \mathbf{P} \# \mathbf{P}'} \abs{J}.
  \]
  For each \(K \in \mathbf{P}\), let \(\mathbf{P}_K\) be the set
  \[
    \mathbf{P}_K = \set{S \in \mathbf{P} \# \mathbf{P}' : S \subseteq K}.
  \]
  Since \(\mathbf{P} \# \mathbf{P}'\) is finer than \(\mathbf{P}\), by \cref{ac:11.1.4} we know that \(\mathbf{P}_K\) is a partition of \(K\), and \(\bigcup_{K \in \mathbf{P}} \mathbf{P}_K = \mathbf{P} \# \mathbf{P}'\).
  Since \(f\) is piecewise constant with respect to \(\mathbf{P}\), by \cref{11.2.7} we know that \(f\) is piecewise constant with respect to \(\mathbf{P} \# \mathbf{P}'\).
  So we have
  \begin{align*}
    p.c. \int_{[\mathbf{P} \# \mathbf{P}']} f & = \sum_{J \in \mathbf{P} \# \mathbf{P}'} c_J \abs{J}                        &                 & \by{11.2.9}                  \\
                                              & = \sum_{J \in \bigcup_{K \in \mathbf{P}} \mathbf{P}_K} c_J \abs{J}                                                           \\
                                              & = \sum_{K \in \mathbf{P}} \sum_{J \in \mathbf{P}_K} c_J \abs{J}             &                 & \text{(by \cref{7.1.11}(e))} \\
                                              & = \sum_{K \in \mathbf{P}} \sum_{J \in \mathbf{P}_K} c_K \abs{J}             & (J \subseteq K)                                \\
                                              & = \sum_{K \in \mathbf{P}} c_K \bigg(\sum_{J \in \mathbf{P}_K} \abs{J}\bigg)                                                  \\
                                              & = \sum_{K \in \mathbf{P}} c_K \abs{K}                                       &                 & \by{11.1.13}                 \\
                                              & = p.c. \int_{[\mathbf{P}]} f.                                               &                 & \by{11.2.9}
  \end{align*}
  Using similar arguments we can show that \(p.c. \int_{[\mathbf{P}']} f = p.c. \int_{[\mathbf{P} \# \mathbf{P}']} f\).
  Thus we have \(p.c. \int_{[\mathbf{P}]} f = p.c. \int_{[\mathbf{P}']} f\).
\end{proof}

\begin{defn}[Piecewise constant integral II]\label{11.2.14}
  Let \(I\) be a bounded interval, and let \(f : I \to \R\) be a piecewise constant function on \(I\).
  We define the \emph{piecewise constant integral} \(p.c. \int_I f\) by the formula
  \[
    p.c. \int_I f \coloneqq p.c. \int_{[\mathbf{P}]} f,
  \]
  where \(\mathbf{P}\) is any partition of \(I\) with respect to which \(f\) is piecewise constant.
  (Note that \cref{11.2.13} tells us that the precise choice of this partition is irrelevant.)
\end{defn}

\setcounter{thm}{15}
\begin{thm}[Laws of integration]\label{11.2.16}
  Let \(I\) be a bounded interval, and let \(f : I \to \R\) and \(g : I \to \R\) be piecewise constant functions on \(I\).
  \begin{enumerate}
    \item We have \(p.c. \int_I (f + g) = p.c. \int_I f + p.c. \int_I g\).
    \item For any real number \(c\), we have \(p.c. \int_I (cf) = c (p.c. \int_I f)\).
    \item We have \(p.c. \int_I (f - g) = p.c. \int_I f - p.c. \int_I g\).
    \item If \(f(x) \geq 0\) for all \(x \in I\), then \(p.c. \int_I f \geq 0\).
    \item If \(f(x) \geq g(x)\) for all \(x \in I\), then \(p.c. \int_I f \geq p.c. \int_I g\).
    \item If \(f\) is the constant function \(f(x) = c\) for all \(x \in I\), then \(p.c. \int_I f = c \abs{I}\).
    \item Let \(J\) be a bounded interval containing \(I\) (i.e., \(I \subseteq J\)), and let \(F : J \to \R\) be the function
          \[
            F(x) \coloneqq \begin{dcases}
              f(x) & \text{if } x \in I    \\
              0    & \text{if } x \notin I
            \end{dcases}
          \]
          Then \(F\) is piecewise constant on \(J\), and \(p.c. \int_J F = p.c. \int_I f\).
    \item Suppose that \(\set{J, K}\) is a partition of \(I\) into two intervals \(J\) and \(K\).
          Then the function \(f|_J : J \to \R\) and \(f|_K : K \to \R\) are piecewise constant on \(J\) and \(K\) respectively, and we have
          \[
            p.c. \int_I f = p.c. \int_J f|_J + p.c. \int_K f|_K.
          \]
  \end{enumerate}
\end{thm}

\begin{proof}{(a)}
  Since \(f, g\) are both piecewise constant on \(I\), by \cref{11.2.3} \(f\) is piecewise constant with respect to \(\mathbf{P}_f\) and \(g\) is piecewise constant with respect to \(\mathbf{P}_g\) for some partitions \(\mathbf{P}_f, \mathbf{P}_g\) of \(I\).
  Let \(\mathbf{P} = (\mathbf{P}_f \# \mathbf{P}_g) \setminus \set{\emptyset}\).
  Then by \cref{11.1.18} we know that \(\mathbf{P}\) is a partition of \(I\) and by \cref{11.2.7} \(f, g\) are piecewise constant with respect to \(\mathbf{P}\).
  For each \(J \in \mathbf{P}\), we define \(c_{f|_J}, c_{g|_J} \in \R\) to be the constant value of \(f|_J, g|_J\), respectively.
  Then by \cref{11.2.1} \(c_{f|_J} + c_{g|_J}\) is the constant value of \((f + g)|_J\) for each \(J \in \mathbf{P}\).
  Thus \(f + g\) is piecewise constant with respect to \(\mathbf{P}\) and
  \begin{align*}
    p.c. \int_I f + p.c. \int_I g & = p.c. \int_{[\mathbf{P}]} f + p.c. \int_{[\mathbf{P}]} g                             &  & \by{11.2.14}                 \\
                                  & = \sum_{J \in \mathbf{P}} c_{f|_J} \abs{J} + \sum_{J \in \mathbf{P}} c_{g|_J} \abs{J} &  & \by{11.2.9}                  \\
                                  & = \sum_{J \in \mathbf{P}} (c_{f|_J} + c_{g|_J}) \abs{J}                               &  & \text{(by \cref{7.1.11}(f))} \\
                                  & = p.c. \int_{[\mathbf{P}]} (f + g)                                                    &  & \by{11.2.9}                  \\
                                  & = p.c. \int_I (f + g).                                                                &  & \by{11.2.14}
  \end{align*}
\end{proof}

\begin{proof}{(b)}
  By \cref{11.2.3} \(f\) is piecewise constant with respect to \(\mathbf{P}\) for some partition \(\mathbf{P}\) of \(I\).
  Without the loss of generality suppose that \(\emptyset \notin \mathbf{P}\).
  For each \(J \in \mathbf{P}\), we define \(c_J \in \R\) to be the constant value of \(f|_J\).
  Then by \cref{11.2.1} \(c \cdot c_J\) is the constant value of \((cf)|_J\).
  Thus \(cf\) is piecewise constant with respect to \(\mathbf{P}\) and
  \begin{align*}
    c \bigg(p.c. \int_I f\bigg) & = c \bigg(p.c. \int_{[\mathbf{P}]} f\bigg)          &  & \by{11.2.14}                 \\
                                & = c \bigg(\sum_{J \in \mathbf{P}} c_J \abs{J}\bigg) &  & \by{11.2.9}                  \\
                                & = \sum_{J \in \mathbf{P}} c \cdot c_J \abs{J}       &  & \text{(by \cref{7.1.11}(g))} \\
                                & = p.c. \int_{[\mathbf{P}]} (c f)                    &  & \by{11.2.9}                  \\
                                & = p.c. \int_I (c f).                                &  & \by{11.2.14}
  \end{align*}
\end{proof}

\begin{proof}{(c)}
  We have
  \begin{align*}
    p.c. \int_I f - p.c. \int_I g & = p.c. \int_I f + (-1) p.c. \int_I g                                    \\
                                  & = p.c. \int_I f + p.c. \int_I (-g)   &  & \text{(by \cref{11.2.16}(b))} \\
                                  & = p.c. \int_I \big(f + (-g)\big)     &  & \text{(by \cref{11.2.16}(a))} \\
                                  & = p.c. \int_I (f - g).               &  & \by{9.2.1}
  \end{align*}
\end{proof}

\begin{proof}{(d)}
  By \cref{11.2.3} \(f\) is piecewise constant with respect to \(\mathbf{P}\) for some partition \(\mathbf{P}\) of \(I\).
  Without the loss of generality suppose that \(\emptyset \notin \mathbf{P}\).
  For each \(J \in \mathbf{P}\), we define \(c_J \in \R\) to be the constant value of \(f|_J\).
  Since \(f(x) \geq 0\) for every \(x \in I\), we have \(c_J \geq 0\) and \(c_J \abs{J} \geq 0\) for every \(J \in \mathbf{P}\).
  Thus
  \begin{align*}
    p.c. \int_I f & = p.c. \int_{[\mathbf{P}]} f          &  & \by{11.2.14}                 \\
                  & = \sum_{J \in \mathbf{P}} c_J \abs{J} &  & \by{11.2.9}                  \\
                  & \geq \sum_{J \in \mathbf{P}} 0        &  & \text{(by \cref{7.1.11}(h))} \\
                  & = 0.
  \end{align*}
\end{proof}

\begin{proof}{(e)}
  Since \(f(x) \geq g(x)\) for all \(x \in I\), we have \(f(x) - g(x) \geq 0\) for all \(x \in I\) and
  \begin{align*}
    p.c. \int_I f - p.c. \int_I g & = p.c. \int_I (f - g) &  & \text{(by \cref{11.2.16}(c))} \\
                                  & \geq 0.               &  & \text{(by \cref{11.2.16}(d))}
  \end{align*}
  Thus
  \[
    p.c. \int_I f \geq p.c. \int_I g.
  \]
\end{proof}

\begin{proof}{(f)}
  Since \(\set{I}\) is a partition of \(I\), we have
  \begin{align*}
    p.c. \int_I f & = p.c. \int_{[I]} f        &  & \by{11.2.14}                 \\
                  & = \sum_{J \in I} c \abs{J} &  & \by{11.2.9}                  \\
                  & = c \sum_{J \in I} \abs{J} &  & \text{(by \cref{7.1.11}(g))} \\
                  & = c \abs{I}.               &  & \by{11.1.13}
  \end{align*}
\end{proof}

\begin{proof}{(g)}
  If \(I = \emptyset\), then by \cref{11.2.3} \(F\) is piecewise constant with respect to \(\set{J}\), and by \cref{11.2.16}(f) we have
  \[
    p.c. \int_J F = 0 \abs{J} = 0 = p.c \int_I f.
  \]
  So suppose that \(I \neq \emptyset\).
  By \cref{11.2.3}, \(f\) is piecewise constant with respect to \(\mathbf{P}\) for some partition \(\mathbf{P}\) of \(I\).
  Let \(I_1, I_2\) be the sets
  \[
    I_1 = \set{x \in J, \big(x \leq \inf(I)\big) \land (x \notin I)}
  \]
  and
  \[
    I_2 = \set{x \in J, \big(x \geq \sup(I)\big) \land (x \notin I)}.
  \]
  By \cref{ac:11.1.5} we know that \(\mathbf{P} \cup \set{I_1, I_2}\) is a partition of \(J\).
  By hypothesis we know that
  \[
    \forall x \in J, F(x) = \begin{dcases}
      f(x) & \text{if } x \in K \text{ for some } K \in \mathbf{P} \\
      0    & \text{if } x \in I_1 \text{ or } x \in I_2
    \end{dcases}
  \]
  Thus by \cref{11.2.5} \(F\) is piecewise constant on \(J\).
  For each \(K \in \mathbf{P} \cup \set{I_1, I_2}\), we define \(c_K \in \R\) to be the constant value of \(F|_K\).
  Then we have
  \begin{align*}
    p.c. \int_J F & = p.c. \int_{[\mathbf{P} \cup \set{I_1, I_2}]} F                              &  & \by{11.2.14}                 \\
                  & = \sum_{K \in \mathbf{P} \cup \set{I_1, I_2}} c_K \abs{K}                     &  & \by{11.2.9}                  \\
                  & = c_{I_1} \abs{I_1} + \sum_{K \in \mathbf{P}} c_K \abs{K} + c_{I_2} \abs{I_2} &  & \text{(by \cref{7.1.11}(e))} \\
                  & = 0 \abs{I_1} + \sum_{K \in \mathbf{P}} c_K \abs{K} + 0 \abs{I_2}             &  & \text{(by hypothesis)}       \\
                  & = \sum_{K \in \mathbf{P}} c_K \abs{K}                                                                           \\
                  & = p.c. \int_{[\mathbf{P}]} f                                                  &  & \by{11.2.9}                  \\
                  & = p.c. \int_I f.                                                              &  & \by{11.2.14}
  \end{align*}
\end{proof}

\begin{proof}{(h)}
  Let \(\mathbf{P} = \set{J, K}\).
  By \cref{11.2.3} \(f\) is piecewise constant with respect to \(\mathbf{P}'\) for some partition \(\mathbf{P}'\) of \(I\).
  Now we define \(\mathbf{P}_J\) as
  \[
    \mathbf{P}_J = \set{S \in \mathbf{P} \# \mathbf{P}' : S \subseteq J}
  \]
  and define \(\mathbf{P}_K\) as
  \[
    \mathbf{P}_K = \set{S \in \mathbf{P} \# \mathbf{P}' : S \subseteq K}.
  \]
  By \cref{11.1.8} we know that \(\mathbf{P} \# \mathbf{P}'\) is a partition of \(I\) and is finer than \(\mathbf{P}\).
  Since \(\mathbf{P} \# \mathbf{P}'\) is finer than \(\mathbf{P}\), by \cref{ac:11.1.4} we know that \(\mathbf{P}_J, \mathbf{P}_K\) are partitions of \(J, K\), respectively.
  Again by \cref{ac:11.1.4} we know that \(\mathbf{P}_J \cup \mathbf{P}_K\) is a partition of \(I\).
  Then by \cref{11.2.7} \(f\) is piecewise constant with respect to \(\mathbf{P}_J \cup \mathbf{P}_K\).
  Without the loss of generality suppose that \(\emptyset \notin \mathbf{P}_J \cup \mathbf{P}_K\).
  For each \(S \in \mathbf{P}_J\), we define \(c_S \in \R\) to be the constant value of \(f|_J\).
  Similarly, for each \(S \in \mathbf{P}_K\), we define \(c_S \in \R\) to be the constant value of \(f|_K\).
  Then we have
  \begin{align*}
    p.c. \int_J f|_J + p.c. \int_K f|_K & = p.c. \int_{[\mathbf{P}_J]} f|_J + p.c. \int_{[\mathbf{P}_K]} f|_K             &  & \by{11.2.14}                 \\
                                        & = \sum_{S \in \mathbf{P}_J} c_S \abs{S} + \sum_{S \in \mathbf{P}_K} c_S \abs{S} &  & \text{(by \cref{7.1.11}(e))} \\
                                        & = \sum_{S \in \mathbf{P}_J \cup \mathbf{P}_K} c_S \abs{S}                       &  & \by{11.2.9}                  \\
                                        & = \sum_{S \in \mathbf{P}} c_S \abs{S}                                                                             \\
                                        & = p.c. \int_{[\mathbf{P}]} f                                                    &  & \by{11.2.9}                  \\
                                        & = p.c. \int_I f.                                                                &  & \by{11.2.14}
  \end{align*}
\end{proof}

\exercisesection

\begin{ex}\label{ex:11.2.1}
  Prove \cref{11.2.7}.
\end{ex}

\begin{proof}
  See \cref{11.2.7}.
\end{proof}

\begin{ex}\label{ex:11.2.2}
  Prove \cref{11.2.8}.
\end{ex}

\begin{proof}
  See \cref{11.2.8}.
\end{proof}

\begin{ex}\label{ex:11.2.3}
  Prove \cref{11.2.13}.
\end{ex}

\begin{proof}
  See \cref{11.2.13}.
\end{proof}

\begin{ex}\label{ex:11.2.4}
  Prove \cref{11.2.16}.
\end{ex}

\begin{proof}
  See \cref{11.2.16}.
\end{proof}