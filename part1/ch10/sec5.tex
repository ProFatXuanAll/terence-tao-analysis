\section{L'H么pital's rule}\label{i:sec:10.5}

\begin{prop}[L'H么pital's rule I]\label{i:10.5.1}
  Let \(X\) be a subset of \(\R\), let \(f : X \to \R\) and \(g : X \to \R\) be functions, and let \(x_0 \in X\) be a limit point of \(X\).
  Suppose that \(f(x_0) = g(x_0) = 0\), that \(f\) and \(g\) are both differentiable at \(x_0\), but \(g'(x_0) \neq 0\).
  Then there exists a \(\delta > 0\) such that \(g(x) \neq 0\) for all \(x \in (X \cap (x_0 - \delta, x_0 + \delta)) \setminus \set{x_0}\), and
  \[
    \lim_{x \to x_0 ; x \in (X \cap (x_0 - \delta, x_0 + \delta)) \setminus \set{x_0}} \dfrac{f(x)}{g(x)} = \dfrac{f'(x_0)}{g'(x_0)}.
  \]
\end{prop}

\begin{proof}
  Since \(g\) is differentiable at \(x_0\), by Newton's approximation (\cref{i:10.1.7}) we have \(\forall \varepsilon \in \R^+\), \(\exists \delta \in \R^+\) such that
  \begin{align*}
             & \forall x \in X, \abs{x - x_0} \leq \dfrac{\delta}{2} < \delta                               \\
    \implies & \abs{g(x) - g(x_0) - g'(x_0)(x - x_0)} \leq \varepsilon \abs{x - x_0}                        \\
    \implies & \abs{g(x) - g'(x_0)(x - x_0)} \leq \varepsilon \abs{x - x_0}          & \big(g(x_0) = 0\big) \\
    \implies & \abs{g'(x_0)(x - x_0) - g(x)} \leq \varepsilon \abs{x - x_0}                                 \\
    \implies & \abs{g'(x_0)(x - x_0)}                                                                       \\
             & \leq \abs{g'(x_0)(x - x_0) - g(x)} + \abs{g(x)}                                              \\
             & \leq \varepsilon \abs{x - x_0} + \abs{g(x)}                                                  \\
    \implies & \abs{g'(x_0)(x - x_0)} - \varepsilon \abs{x - x_0} \leq \abs{g(x)}                           \\
    \implies & \big(\abs{g'(x_0)} - \varepsilon\big)\abs{x - x_0} \leq \abs{g(x)}.
  \end{align*}
  Since \(g'(x_0) \neq 0\), we know \(\dfrac{\abs{g'(x_0)}}{2} > 0\).
  By setting \(\varepsilon = \dfrac{\abs{g'(x_0)}}{2}\) we know \(\exists \delta \in \R^+\) such that
  \begin{align*}
             & \forall x \in X, \abs{x - x_0} < \delta                                            \\
    \implies & \bigg(\abs{g'(x_0)} - \dfrac{\abs{g'(x_0)}}{2}\bigg) \abs{x - x_0} \leq \abs{g(x)} \\
    \implies & 0 \leq \dfrac{\abs{g'(x_0)}}{2} \abs{x - x_0} \leq \abs{g(x)}.
  \end{align*}
  Observe that
  \[
    (x \in X) \land (\abs{x - x_0} < \delta) \iff x \in X \cap (x_0 - \delta, x_0 + \delta).
  \]
  Then we have
  \[
    \exists \delta \in \R^+ : \forall x \in X \cap (x_0 - \delta, x_0 + \delta), 0 \leq \dfrac{\abs{g'(x_0)}}{2} \abs{x - x_0} \leq \abs{g(x)}.
  \]
  In particular, we have
  \[
    \exists \delta \in \R^+ : \forall x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}, 0 < \dfrac{\abs{g'(x_0)}}{2} \abs{x - x_0} \leq \abs{g(x)}.
  \]
  This means \(g(x) \neq 0\) for every \(x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}\).
  Thus
  \begin{align*}
      & \lim_{x \to x_0 ; x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}} \dfrac{f(x)}{g(x)}                                                                                                                                                                                        \\
    = & \lim_{x \to x_0 ; x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}} \dfrac{f(x) - f(x_0)}{g(x) - g(x_0)}                                                                                                                              & (f(x_0) = g(x_0) = 0)                 \\
    = & \lim_{x \to x_0 ; x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}} \dfrac{f(x) - f(x_0)}{x - x_0} \dfrac{x - x_0}{g(x) - g(x_0)}                                                                                                     & (x \neq x_0)                          \\
    = & \dfrac{\lim_{x \to x_0 ; x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}} \dfrac{f(x) - f(x_0)}{x - x_0}}{\lim_{x \to x_0 ; x \in \big(X \cap (x_0 - \delta, x_0 + \delta)\big) \setminus \set{x_0}} \dfrac{g(x) - g(x_0)}{x - x_0}} &                       & \by{i:9.3.14} \\
    = & \dfrac{f'(x_0)}{g'(x_0)}.                                                                                                                                                                                                                                    &                       & \by{i:10.1.1}
  \end{align*}
\end{proof}

\begin{note}
  The presence of the \(\delta\) here may seem somewhat strange, but is needed because \(g(x)\) might vanish at some points other than \(x_0\), which would imply that quotient \(\dfrac{f(x)}{g(x)}\) is not necessarily defined at all points in \(X \setminus \set{x_0}\).
\end{note}

\begin{prop}[L'H么pital's rule II]\label{i:10.5.2}
  Let \(a < b\) be real numbers, let \(f : [a, b] \to \R\) and \(g : [a, b] \to \R\) be functions which are differentiable on \([a, b]\).
  Suppose that \(f(a) = g(a) = 0\), that \(g'\) is non-zero on \([a, b]\) (i.e., \(g'(x) \neq 0\) for all \(x \in [a, b]\)), and \(\lim_{x \to a ; x \in (a, b]} \dfrac{f'(x)}{g'(x)}\) exists and equals to \(L\).
  Then \(g(x) \neq 0\) for all \(x \in (a, b]\), and \(\lim_{x \to a ; x \in (a, b]} \dfrac{f(x)}{g(x)}\) exists and equals to \(L\).
\end{prop}

\begin{proof}
  We first show that \(g(x) \neq 0\) for all \(x \in (a, b]\).
  Suppose for the sake of contradiction that \(g(x) = 0\) for some \(x \in (a, b]\).
  But since \(g(a)\) is also zero, we can apply Rolle's theorem (\cref{i:10.2.7}) to obtain \(g'(y) = 0\) for some \(a < y < x\), but this contradicts the hypothesis that \(g'\) is non-zero on \([a, b]\).

  Now we show that \(\lim_{x \to a ; x \in (a, b]} \dfrac{f(x)}{g(x)} = L\).
  By \cref{i:9.3.9}, it will suffice to show that
  \[
    \lim_{n \to \infty} \dfrac{f(x_n)}{g(x_n)} = L
  \]
  for any sequence \((x_n)_{n = 0}^\infty\) taking values in \((a, b]\) which converges to \(a\).

  Consider a single \(x_n\), and consider the function \(h_n : [a, x_n] \to \R\) defined by
  \[
    h_n(x) \coloneqq f(x) g(x_n) - g(x) f(x_n).
  \]
  Observe that \(h_n\) is continuous on \([a, x_n]\) and equals \(0\) at both \(a\) and \(x_n\), and is differentiable on \((a, x_n)\) with derivative \(h_n'(x) = f'(x) g(x_n) - g'(x) f(x_n)\).
  (Note that \(f(x_n)\) and \(g(x_n)\) are constants with respect to \(x\).)
  By Rolle's theorem (\cref{i:10.2.7}), we can thus find \(y_n \in (a, x_n)\) such that \(h_n'(y_n) = 0\), which implies that
  \[
    \dfrac{f(x_n)}{g(x_n)} = \dfrac{f'(y_n)}{g'(y_n)}.
  \]
  Since \(y_n \in (a, x_n)\) for all \(n\), and \(x_n\) converges to \(a\) as \(n \to \infty\), we see from the squeeze test (\cref{i:6.4.14}) that \(y_n\) also converges to \(a\) as \(n \to \infty\).
  Thus, \(\dfrac{f'(y_n)}{g'(y_n)}\) converges to \(L\), and thus \(\dfrac{f(x_n)}{g(x_n)}\) also converges to \(L\), as desired.
\end{proof}

\begin{note}
  In \cref{i:10.5.2}, the hypothesis that \(f, g\) be differentiable on \([a, b]\) may be weakened to being continuous on \([a, b]\) and differentiable on \((a, b]\), with \(g'\) only assumed to be non-zero on \((a, b]\) rather than \([a, b]\).
\end{note}

\begin{rmk}\label{i:10.5.3}
  This proposition only considers limits to the right of \(a\), but one can easily state and prove a similar proposition for limits to the left of \(a\), or around both sides of \(a\).
  Speaking very informally, \cref{i:10.5.2} states that
  \[
    \lim_{x \to a} \dfrac{f(x)}{g(x)} = \lim_{x \to a} \dfrac{f'(x)}{g'(x)},
  \]
  though one has to ensure all of the conditions of the proposition hold (in particular, that \(f(a) = g(a) = 0\), and that the right-hand limit exists), before one can apply L'H么pital's rule.
\end{rmk}

\exercisesection

\begin{ex}\label{i:ex:10.5.1}
  Prove \cref{i:10.5.1}.
\end{ex}

\begin{proof}
  See \cref{i:10.5.1}.
\end{proof}

\begin{ex}\label{i:ex:10.5.2}
  Explain why Exercise 1.2.12 does not contradict either of the propositions in this section.
\end{ex}

\begin{proof}
  In first example we have \(g(0) \neq 0\).
  In second example the limit
  \[
    \lim_{x \to 0 ; x \in (0, \infty)} \dfrac{f'(x)}{g'(x)}
  \]
  doest not exists.
  Thus, Exercise 1.2.12 does not contradict either of the propositions in this section.
\end{proof}
